import{useStores as e,defineInterface as t}from"@directus/extensions-sdk";import{computed as n,defineComponent as i,resolveComponent as a,resolveDirective as o,openBlock as l,createElementBlock as r,withDirectives as c,createBlock as u,unref as d,createSlots as p,withCtx as s,createVNode as f,withModifiers as v,createCommentVNode as m,createElementVNode as y}from"vue";import{useI18n as h}from"vue-i18n";const g={class:"action-interface"},b=["href"];var k=i({__name:"interface",props:{value:{type:[String,Number],default:null},contentType:{type:String,default:"other"},clickAction:{type:String,default:"default"},showCopy:{type:Boolean,default:!1},showLink:{type:Boolean,default:!1},placeholder:{type:String,default:null},iconLeft:{type:String,default:null},iconRight:{type:String,default:null},min:{type:Number,default:void 0},max:{type:Number,default:void 0},step:{type:Number,default:1},type:{type:String,default:null},disabled:{type:Boolean,default:!1}},emits:["input"],setup(t,{emit:i}){const k=t,_=n((()=>["bigInteger","integer","float","decimal"].includes(k.type)?"number":"text")),w=n((()=>"copy"===k.clickAction&&C?"Copy value":"link"===k.clickAction?"Open link":void 0)),{computedLink:x}=function(e){return{computedLink:n((()=>"url"===e.contentType?e.value:"email"===e.contentType?`mailto:${e.value}`:"phone"===e.contentType?`tel:${e.value}`:e.value))}}(k),{isCopySupported:C,copyToClipboard:T}=function(){const{t:e}=h();return{isCopySupported:n((()=>{var e;return!!(null===(e=null===navigator||void 0===navigator?void 0:navigator.clipboard)||void 0===e?void 0:e.writeText)})),isPasteSupported:n((()=>{var e;return!!(null===(e=null===navigator||void 0===navigator?void 0:navigator.clipboard)||void 0===e?void 0:e.readText)})),copyToClipboard:async function(t,n,i){var a,o,l;try{return await(null===(a=null===navigator||void 0===navigator?void 0:navigator.clipboard)||void 0===a?void 0:a.writeText(t)),n.add({title:null!==(o=null==i?void 0:i.success)&&void 0!==o?o:e("copy_raw_value_success")}),!0}catch(t){return n.add({type:"error",title:null!==(l=null==i?void 0:i.fail)&&void 0!==l?l:e("copy_raw_value_fail")}),!1}},pasteFromClipboard:async function(t,n){var i,a,o;try{const o=await(null===(i=null===navigator||void 0===navigator?void 0:navigator.clipboard)||void 0===i?void 0:i.readText());return t.add({title:null!==(a=null==n?void 0:n.success)&&void 0!==a?a:e("paste_raw_value_success")}),o}catch(i){return t.add({type:"error",title:null!==(o=null==n?void 0:n.fail)&&void 0!==o?o:e("paste_raw_value_fail")}),null}}}}(),{useNotificationsStore:S}=e(),$=S();async function A(){await T("number"===_.value?k.value.toString():k.value,$)}function L(e){"copy"===k.clickAction&&k.disabled&&k.value&&(e.stopPropagation(),A())}return(e,n)=>{const i=a("v-icon"),h=a("v-input"),k=a("v-button"),T=o("tooltip");return l(),r("div",g,[c((l(),u(h,{"model-value":t.value,disabled:t.disabled,type:d(_),placeholder:t.placeholder,min:t.min,max:t.max,step:t.step,"onUpdate:modelValue":n[0]||(n[0]=t=>e.$emit("input",t)),onClick:L},p({_:2},[t.iconLeft?{name:"prepend",fn:s((()=>[f(i,{name:t.iconLeft},null,8,["name"])]))}:void 0,t.iconRight?{name:"append",fn:s((()=>[f(i,{name:t.iconRight},null,8,["name"])]))}:void 0]),1032,["model-value","disabled","type","placeholder","min","max","step"])),[[T,d(w)]]),t.showCopy&&d(C)?c((l(),u(k,{key:0,disabled:!t.value,icon:"",secondary:""},{default:s((()=>[f(i,{name:"content_copy",onClick:v(A,["stop"])},null,8,["onClick"])])),_:1},8,["disabled"])),[[T,t.value?`Copy to clipboard: ${t.value}`:"Can't copy empty value"]]):m("v-if",!0),m(' TODO: button supports :to=routerLink and :href=custom link. Switch from custom a-tag to those. Use condition: href for full url and "to" for internal links (incomplete url)  '),t.showLink?c((l(),u(k,{key:1,disabled:!t.value,icon:"",secondary:""},{default:s((()=>[y("a",{href:d(x),target:"_blank",rel:"noopener noreferrer",onClick:n[1]||(n[1]=v((()=>{}),["stop"]))},[f(i,{name:"open_in_new"})],8,b)])),_:1},8,["disabled"])),[[T,t.value?`Follow link: ${d(x)}`:"Can't follow empty link"]]):m("v-if",!0)])}}}),_=[],w=[];function x(e){const t=[{text:"Other",value:"other"},{text:"Phone",value:"phone"}];return e&&t.push({text:"URL",value:"url"},{text:"E-Mail",value:"email"}),t}function C(e){const t=[{text:"Copy to clipboard",value:"copy"},{text:"Default click action",value:"default"}];return e&&t.push({text:"Open link",value:"link"}),t}!function(e,t){if(e&&"undefined"!=typeof document){var n,i=!0===t.prepend?"prepend":"append",a=!0===t.singleTag,o="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(a){var l=_.indexOf(o);-1===l&&(l=_.push(o)-1,w[l]={}),n=w[l]&&w[l][i]?w[l][i]:w[l][i]=r()}else n=r();65279===e.charCodeAt(0)&&(e=e.substring(1)),n.styleSheet?n.styleSheet.cssText+=e:n.appendChild(document.createTextNode(e))}function r(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var n=Object.keys(t.attributes),a=0;a<n.length;a++)e.setAttribute(n[a],t.attributes[n[a]]);var l="prepend"===i?"afterbegin":"beforeend";return o.insertAdjacentElement(l,e),e}}(".action-interface[data-v-64969d30] {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n}\n.action-interface .v-button[data-v-64969d30] {\n  margin-left: 1rem;\n}",{}),k.__scopeId="data-v-64969d30",k.__file="src/interface.vue";var T=t({id:"custom",name:"Action interface",icon:"ads_click",description:"Display content with actions like linking or copy to clipboard. (By clicking on the content (only at readonly) and seperate buttons)! NOTE: the content needs to match the schema",component:k,types:["uuid","string","text","bigInteger","integer","decimal","float"],options:({field:e})=>{var t,n,i;const a=["string","text"].includes(null!==(t=e.type)&&void 0!==t?t:"unknown"),o=function(e){return[{field:"contentType",name:"Fields content type",type:"string",meta:{width:"full",interface:"select-dropdown",options:{choices:x(e)}},schema:{default_value:"other"}},{field:"showCopy",name:"Display copy icon",type:"boolean",meta:{width:"full",interface:"boolean",options:{label:"Display a copy button next to the item"}},schema:{default_value:!1}},{field:"showLink",name:"Display link icon",type:"boolean",meta:{width:"full",interface:"boolean",options:{label:"Display a link button next to the item"}},schema:{default_value:!1}}]}(a),l=[{field:"placeholder",name:"$t:placeholder",meta:{width:"half",interface:"system-input-translated-string",options:{placeholder:"$t:enter_a_placeholder"}}},{field:"iconLeft",name:"$t:icon_left",type:"string",meta:{width:"half",interface:"select-icon"}},{field:"iconRight",name:"$t:icon_right",type:"string",meta:{width:"half",interface:"select-icon"}}],r=[{field:"clickAction",name:"Click Action (when clicking on the value)",type:"string",meta:{width:"full",interface:"select-dropdown",options:{choices:C(a)}},schema:{default_value:"default"}}],c=[{field:"min",name:"$t:interfaces.input.minimum_value",type:"integer",meta:{width:"half",interface:"input"}},{field:"max",name:"$t:interfaces.input.maximum_value",type:"integer",meta:{width:"half",interface:"input"}},{field:"step",name:"$t:interfaces.input.step_interval",type:"integer",meta:{width:"half",interface:"input"},schema:{default_value:1}}];if(e.type&&["bigInteger","integer","float","decimal"].includes(e.type)){const t=[...l,...c,...o];return(null===(n=e.meta)||void 0===n?void 0:n.readonly)&&t.push(...r),t}const u=[...l,...o];return(null===(i=e.meta)||void 0===i?void 0:i.readonly)&&u.push(...r),u}});export{T as default};
